<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Café Elegante - Experiencia Gourmet</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8B5A2B',
                        secondary: '#D2B48C',
                        accent: '#A67C52',
                        light: '#F5F5DC',
                        dark: '#3C2A1E',
                    },
                    fontFamily: {
                        heading: ['Playfair Display', 'serif'],
                        body: ['Poppins', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        html { scroll-behavior: smooth; }
        .menu-item { transition: transform 0.3s ease; }
        .menu-item:hover { transform: translateY(-10px); }
        .menu-item-img img { transition: transform 0.5s ease; }
        .menu-item:hover .menu-item-img img { transform: scale(1.1); }
        .dropdown-menu {
            opacity: 0; transform: translateY(-10px); visibility: hidden;
            transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s;
        }
        .dropdown-menu.active { opacity: 1; transform: translateY(0); visibility: visible; }
        .add-to-cart-btn { transition: transform 0.3s ease, background-color 0.3s ease; }
        .add-to-cart-btn:hover { transform: scale(1.1); }
        .cart-modal {
            opacity: 0; transform: translateY(-20px); visibility: hidden;
            transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s;
        }
        .cart-modal.active { opacity: 1; transform: translateY(0); visibility: visible; }
        @keyframes cartBadgePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .cart-badge-pulse { animation: cartBadgePulse 0.5s ease; }
        .file-upload-area {
            border: 2px dashed #d1d5db;
            transition: border-color 0.3s ease;
        }
        .file-upload-area:hover {
            border-color: #8B5A2B;
        }
        .file-upload-area.dragover {
            border-color: #8B5A2B;
            background-color: #f9fafb;
        }
    </style>
</head>
<body class="font-body text-dark bg-light">
    <!-- Navigation -->
    <nav class="fixed top-0 left-0 w-full bg-gradient-to-r from-dark/90 to-primary/90 z-50 transition-all duration-300" id="main-nav">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <a href="#" class="font-heading text-2xl text-white">Café Elegante</a>
                <ul class="hidden md:flex items-center space-x-8">
                    <li><a href="#home" class="text-white hover:text-secondary transition-colors">Inicio</a></li>
                    <li class="relative">
                        <a href="#menu" class="text-white hover:text-secondary transition-colors flex items-center" id="menu-dropdown-toggle">
                            Menú
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </a>
                        <div class="dropdown-menu absolute left-0 mt-2 w-48 bg-white rounded-md shadow-lg py-2 z-50" id="menu-dropdown">
                            <a href="#cafeteria" class="block px-4 py-2 text-dark hover:bg-primary hover:text-white transition-colors">Cafetería</a>
                            <a href="#jugos" class="block px-4 py-2 text-dark hover:bg-primary hover:text-white transition-colors">Jugos</a>
                            <a href="#postres" class="block px-4 py-2 text-dark hover:bg-primary hover:text-white transition-colors">Postres</a>
                        </div>
                    </li>
                    <li><a href="#contact" class="text-white hover:text-secondary transition-colors">Contacto</a></li>
                    <li class="relative">
                        <a href="#" class="text-white hover:text-secondary transition-colors flex items-center" id="cart-toggle">
                            <span class="relative">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                                <span class="absolute -top-2 -right-2 bg-secondary text-dark text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center" id="cart-count">0</span>
                            </span>
                            <span class="ml-2">Carrito</span>
                        </a>
                        
                        <!-- Modal del carrito -->
                        <div class="cart-modal absolute right-0 mt-2 w-80 bg-white rounded-md shadow-lg py-4 z-50" id="cart-modal">
                            <div class="px-4 py-2 border-b border-gray-200">
                                <h3 class="font-heading text-lg text-primary">Tu Carrito</h3>
                            </div>
                            <div class="max-h-96 overflow-y-auto p-4" id="cart-items">
                                <div class="text-center text-gray-500 py-8" id="empty-cart-message">
                                    Tu carrito está vacío
                                </div>
                            </div>
                            <div class="px-4 py-3 border-t border-gray-200">
                                <div class="flex justify-between font-medium mb-4">
                                    <span>Total:</span>
                                    <span id="cart-total">$0.00</span>
                                </div>
                                <button id="realizar-pedido-btn" class="w-full py-2 bg-gradient-to-r from-primary to-accent text-white rounded-lg hover:opacity-90 transition-opacity">
                                    Realizar Pedido
                                </button>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Modal de QR para Pago -->
    <div class="fixed inset-0 bg-black/70 z-[2000] hidden justify-center items-center" id="qr-modal">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 relative overflow-hidden">
            <button class="absolute top-3 right-3 text-gray-500 hover:text-gray-800" id="close-qr-modal">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            
            <div class="p-6 text-center">
                <h3 class="text-2xl font-heading font-bold mb-4 text-primary">Realizar Pago</h3>
                <div class="mb-4">
                    <p class="text-lg font-medium mb-2">Total a pagar:</p>
                    <p class="text-3xl font-bold text-accent" id="qr-total">$0.00</p>
                </div>
                
                <div class="mb-6">
                    <p class="text-sm text-gray-600 mb-4">Realiza la transferencia a la siguiente cuenta:</p>
                    <div class="flex justify-center mb-4">
                        <img id="qr-image" src="/static/images/cuenta_bancaria.jpg" alt="Datos de cuenta bancaria" class="max-w-full h-auto border border-gray-300 rounded-lg shadow-md">
                    </div>
                </div>

                <!-- Área de subida de comprobante -->
                <div class="mb-6">
                    <p class="text-sm font-medium text-gray-700 mb-3">Sube tu comprobante de pago:</p>
                    
                    <!-- Área de drag & drop -->
                    <div class="file-upload-area rounded-lg p-6 text-center cursor-pointer" id="file-upload-area">
                        <input type="file" id="comprobante-input" accept="image/*" class="hidden">
                        <div id="upload-placeholder">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            <p class="text-sm text-gray-600">Haz clic aquí o arrastra tu comprobante</p>
                            <p class="text-xs text-gray-400 mt-1">PNG, JPG hasta 5MB</p>
                        </div>
                        <div id="file-preview" class="hidden">
                            <img id="preview-image" src="/placeholder.svg" alt="Vista previa" class="max-w-full h-32 object-cover mx-auto rounded-lg mb-2">
                            <p id="file-name" class="text-sm text-gray-600"></p>
                            <button type="button" id="remove-file" class="text-red-500 text-xs hover:underline">Eliminar</button>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <button id="subir-comprobante-btn" class="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400" disabled>
                        Subir Comprobante
                    </button>
                    <button id="confirmar-sin-comprobante-btn" class="w-full py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                        Ya realicé la transferencia (sin comprobante)
                    </button>
                    <button id="cancelar-pago-btn" class="w-full py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmación -->
    <div class="fixed inset-0 bg-black/70 z-[2000] hidden justify-center items-center" id="confirmacion-modal">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 relative overflow-hidden">
            <div class="p-6 text-center">
                <div class="mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-500 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </div>
                <h3 class="text-2xl font-heading font-bold mb-4 text-primary">¡Pedido Confirmado!</h3>
                <p class="text-gray-600 mb-6" id="confirmacion-mensaje">Tu pedido ha sido procesado exitosamente. Recibirás una notificación cuando esté listo.</p>
                <button id="cerrar-confirmacion-btn" class="w-full py-3 bg-gradient-to-r from-primary to-accent text-white rounded-lg hover:opacity-90 transition-opacity">
                    Continuar
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header id="home" class="h-screen bg-gradient-to-b from-dark/80 to-primary/80 bg-cover bg-center flex flex-col justify-center items-center text-center text-white relative" style="background-image: url('/placeholder.svg?height=1080&width=1920')">
        <div class="z-10 px-4">
            <h1 class="font-heading text-5xl md:text-6xl mb-6 text-white shadow-text">Café Elegante</h1>
            <p class="text-xl md:text-2xl max-w-2xl mb-8">Una experiencia gourmet para los amantes del buen café</p>
            <a href="#menu" class="px-8 py-3 bg-gradient-to-r from-primary to-accent text-white rounded-full hover:shadow-lg transition-all duration-300 border-2 border-secondary">Ver Menú</a>
        </div>
    </header>

    <!-- Menu Section -->
    <section id="menu" class="py-24 bg-white">
        <div class="container mx-auto px-4">
            <div class="text-center mb-16">
                <h2 class="font-heading text-4xl text-primary inline-block relative pb-3 after:content-[''] after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:w-20 after:h-1 after:bg-accent">Nuestro Menú</h2>
            </div>

            <!-- Productos dinámicos desde Django -->
            {% for categoria in categorias %}
            <div id="{{ categoria.nombre|lower }}" class="mb-20 scroll-mt-40">
                <h3 class="font-heading text-3xl text-accent text-center mb-10">{{ categoria.nombre }}</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    {% for producto in productos %}
                    {% if producto.categoria == categoria %}
                    <div class="menu-item bg-light rounded-xl overflow-hidden shadow-lg">
                        <div class="menu-item-img h-48 overflow-hidden">
                            <img src="{{ producto.url_imagen }}" alt="{{ producto.nombre }}" class="w-full h-full object-cover">
                        </div>
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-heading text-xl text-primary">{{ producto.nombre }}</h4>
                                <span class="font-bold text-accent">${{ producto.precio }}</span>
                            </div>
                            <p class="text-sm text-dark mb-4">{{ producto.descripcion }}</p>
                            <div class="flex justify-end">
                                <button class="add-to-cart-btn w-10 h-10 bg-gradient-to-r from-primary to-accent rounded-full flex items-center justify-center text-white shadow-md" 
                                        data-id="{{ producto.id_producto }}" 
                                        data-name="{{ producto.nombre }}" 
                                        data-price="{{ producto.precio }}" 
                                        data-image="{{ producto.url_imagen }}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-white py-8 mt-24">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 Café Elegante. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script>
        // Carrito de compras
        let cart = [];
        let cartTotal = 0;
        let currentVentaId = null;
        let selectedFile = null;

        // Elementos del DOM
        const cartCount = document.getElementById('cart-count');
        const cartToggle = document.getElementById('cart-toggle');
        const cartModal = document.getElementById('cart-modal');
        const cartItems = document.getElementById('cart-items');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const cartTotalElement = document.getElementById('cart-total');
        const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');
        const realizarPedidoBtn = document.getElementById('realizar-pedido-btn');
        
        // Elementos del modal QR
        const qrModal = document.getElementById('qr-modal');
        const closeQrModal = document.getElementById('close-qr-modal');
        const qrTotal = document.getElementById('qr-total');
        const qrImage = document.getElementById('qr-image');
        const subirComprobanteBtn = document.getElementById('subir-comprobante-btn');
        const confirmarSinComprobanteBtn = document.getElementById('confirmar-sin-comprobante-btn');
        const cancelarPagoBtn = document.getElementById('cancelar-pago-btn');
        
        // Elementos de subida de archivos
        const fileUploadArea = document.getElementById('file-upload-area');
        const comprobanteInput = document.getElementById('comprobante-input');
        const uploadPlaceholder = document.getElementById('upload-placeholder');
        const filePreview = document.getElementById('file-preview');
        const previewImage = document.getElementById('preview-image');
        const fileName = document.getElementById('file-name');
        const removeFileBtn = document.getElementById('remove-file');
        
        // Elementos del modal de confirmación
        const confirmacionModal = document.getElementById('confirmacion-modal');
        const confirmacionMensaje = document.getElementById('confirmacion-mensaje');
        const cerrarConfirmacionBtn = document.getElementById('cerrar-confirmacion-btn');

        // Función para obtener el token CSRF
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Manejo de archivos
        fileUploadArea.addEventListener('click', () => {
            comprobanteInput.click();
        });

        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('dragover');
        });

        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.classList.remove('dragover');
        });

        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        comprobanteInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        removeFileBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            clearFileSelection();
        });

        function handleFileSelect(file) {
            // Validar tipo de archivo
            if (!file.type.startsWith('image/')) {
                alert('Por favor selecciona una imagen válida');
                return;
            }

            // Validar tamaño (5MB máximo)
            if (file.size > 5 * 1024 * 1024) {
                alert('El archivo es demasiado grande. Máximo 5MB');
                return;
            }

            selectedFile = file;
            
            // Mostrar vista previa
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                fileName.textContent = file.name;
                uploadPlaceholder.classList.add('hidden');
                filePreview.classList.remove('hidden');
                subirComprobanteBtn.disabled = false;
            };
            reader.readAsDataURL(file);
        }

        function clearFileSelection() {
            selectedFile = null;
            comprobanteInput.value = '';
            uploadPlaceholder.classList.remove('hidden');
            filePreview.classList.add('hidden');
            subirComprobanteBtn.disabled = true;
        }

        // Función para añadir un producto al carrito
        function addToCart(id, name, price, image) {
            const existingItem = cart.find(item => item.id === id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id,
                    name,
                    price: parseFloat(price),
                    image,
                    quantity: 1
                });
            }
            
            updateCartCount();
            updateCartContent();
            calculateTotal();
        }

        // Función para actualizar el contador del carrito
        function updateCartCount() {
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            cartCount.textContent = totalItems;
            
            cartCount.classList.add('cart-badge-pulse');
            setTimeout(() => {
                cartCount.classList.remove('cart-badge-pulse');
            }, 500);
        }

        // Función para actualizar el contenido del carrito
        function updateCartContent() {
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                emptyCartMessage.style.display = 'block';
            } else {
                emptyCartMessage.style.display = 'none';
                
                cart.forEach(item => {
                    const cartItemElement = createCartItemElement(item);
                    cartItems.appendChild(cartItemElement);
                });
            }
        }

        // Función para crear un elemento de item del carrito
        function createCartItemElement(item) {
            const cartItem = document.createElement('div');
            cartItem.className = 'flex items-center py-2 border-b border-gray-100';
            
            cartItem.innerHTML = `
                <div class="h-16 w-16 flex-shrink-0 overflow-hidden rounded-md border border-gray-200">
                    <img src="${item.image}" alt="${item.name}" class="h-full w-full object-cover">
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-sm font-medium text-gray-900">${item.name}</h3>
                    <div class="flex items-center justify-between mt-1">
                        <div class="flex items-center">
                            <button class="decrease-quantity text-xs px-2 py-1 bg-gray-100 rounded-l-md" data-id="${item.id}">-</button>
                            <span class="text-xs px-2 py-1 bg-gray-50">${item.quantity}</span>
                            <button class="increase-quantity text-xs px-2 py-1 bg-gray-100 rounded-r-md" data-id="${item.id}">+</button>
                        </div>
                        <div class="flex items-center">
                            <span class="text-sm font-medium text-gray-900">$${(item.price * item.quantity).toFixed(2)}</span>
                            <button class="remove-from-cart ml-2 text-red-500" data-id="${item.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Event listeners para los botones
            const decreaseButton = cartItem.querySelector('.decrease-quantity');
            const increaseButton = cartItem.querySelector('.increase-quantity');
            const removeButton = cartItem.querySelector('.remove-from-cart');
            
            decreaseButton.addEventListener('click', () => decreaseQuantity(item.id));
            increaseButton.addEventListener('click', () => increaseQuantity(item.id));
            removeButton.addEventListener('click', () => removeFromCart(item.id));
            
            return cartItem;
        }

        // Funciones para manejar cantidades
        function decreaseQuantity(id) {
            const item = cart.find(item => item.id === id);
            if (item) {
                if (item.quantity > 1) {
                    item.quantity -= 1;
                } else {
                    removeFromCart(id);
                    return;
                }
                updateCartCount();
                updateCartContent();
                calculateTotal();
            }
        }

        function increaseQuantity(id) {
            const item = cart.find(item => item.id === id);
            if (item) {
                item.quantity += 1;
                updateCartCount();
                updateCartContent();
                calculateTotal();
            }
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            updateCartCount();
            updateCartContent();
            calculateTotal();
        }

        // Función para calcular el total del carrito
        function calculateTotal() {
            cartTotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            cartTotalElement.textContent = `$${cartTotal.toFixed(2)}`;
        }

        // Función para realizar pedido
        async function realizarPedido() {
            if (cart.length === 0) {
                alert('El carrito está vacío');
                return;
            }

            try {
                const response = await fetch('/crear-pedido/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({
                        cart_items: cart.map(item => ({
                            id: item.id,
                            name: item.name,
                            price: item.price,
                            quantity: item.quantity
                        }))
                    })
                });

                const data = await response.json();

                if (data.success) {
                    currentVentaId = data.venta_id;
                    qrTotal.textContent = `$${data.total.toFixed(2)}`;
                    qrImage.src = data.qr_image_url;
                    
                    // Limpiar selección de archivo
                    clearFileSelection();
                    
                    // Cerrar modal del carrito y abrir modal QR
                    cartModal.classList.remove('active');
                    qrModal.classList.remove('hidden');
                    qrModal.classList.add('flex');
                } else {
                    alert('Error al crear el pedido: ' + data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al procesar el pedido');
            }
        }

        // Función para subir comprobante
        async function subirComprobante() {
            if (!currentVentaId || !selectedFile) {
                alert('No hay pedido activo o archivo seleccionado');
                return;
            }

            const formData = new FormData();
            formData.append('venta_id', currentVentaId);
            formData.append('comprobante', selectedFile);

            try {
                subirComprobanteBtn.disabled = true;
                subirComprobanteBtn.textContent = 'Subiendo...';

                const response = await fetch('/subir-comprobante/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    // Cerrar modal QR y mostrar confirmación
                    qrModal.classList.remove('flex');
                    qrModal.classList.add('hidden');
                    confirmacionMensaje.textContent = data.message;
                    confirmacionModal.classList.remove('hidden');
                    confirmacionModal.classList.add('flex');
                    
                    // Limpiar carrito
                    cart = [];
                    currentVentaId = null;
                    updateCartCount();
                    updateCartContent();
                    calculateTotal();
                } else {
                    alert('Error al subir el comprobante: ' + data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al subir el comprobante');
            } finally {
                subirComprobanteBtn.disabled = false;
                subirComprobanteBtn.textContent = 'Subir Comprobante';
            }
        }

        // Función para confirmar pago sin comprobante
        async function confirmarSinComprobante() {
            if (!currentVentaId) {
                alert('No hay pedido activo');
                return;
            }

            try {
                const response = await fetch('/confirmar-pago/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({
                        venta_id: currentVentaId
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Cerrar modal QR y mostrar confirmación
                    qrModal.classList.remove('flex');
                    qrModal.classList.add('hidden');
                    confirmacionMensaje.textContent = data.message;
                    confirmacionModal.classList.remove('hidden');
                    confirmacionModal.classList.add('flex');
                    
                    // Limpiar carrito
                    cart = [];
                    currentVentaId = null;
                    updateCartCount();
                    updateCartContent();
                    calculateTotal();
                } else {
                    alert('Error al confirmar el pago: ' + data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al confirmar el pago');
            }
        }

        // Event listeners
        addToCartButtons.forEach(button => {
            button.addEventListener('click', function() {
                const id = this.dataset.id;
                const name = this.dataset.name;
                const price = this.dataset.price;
                const image = this.dataset.image;
                
                addToCart(id, name, price, image);
            });
        });

        cartToggle.addEventListener('click', function(e) {
            e.preventDefault();
            cartModal.classList.toggle('active');
        });

        realizarPedidoBtn.addEventListener('click', realizarPedido);

        // Event listeners para modales
        closeQrModal.addEventListener('click', function() {
            qrModal.classList.remove('flex');
            qrModal.classList.add('hidden');
        });

        cancelarPagoBtn.addEventListener('click', function() {
            qrModal.classList.remove('flex');
            qrModal.classList.add('hidden');
        });

        subirComprobanteBtn.addEventListener('click', subirComprobante);
        confirmarSinComprobanteBtn.addEventListener('click', confirmarSinComprobante);

        cerrarConfirmacionBtn.addEventListener('click', function() {
            confirmacionModal.classList.remove('flex');
            confirmacionModal.classList.add('hidden');
        });

        // Cerrar modales al hacer clic fuera
        document.addEventListener('click', function(e) {
            if (!cartToggle.contains(e.target) && !cartModal.contains(e.target)) {
                cartModal.classList.remove('active');
            }
        });

        qrModal.addEventListener('click', function(e) {
            if (e.target === qrModal) {
                qrModal.classList.remove('flex');
                qrModal.classList.add('hidden');
            }
        });

        confirmacionModal.addEventListener('click', function(e) {
            if (e.target === confirmacionModal) {
                confirmacionModal.classList.remove('flex');
                confirmacionModal.classList.add('hidden');
            }
        });

        // Navegación suave
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    window.scrollTo({
                        top: target.offsetTop - 100,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // Efecto de navegación al hacer scroll
        window.addEventListener('scroll', function() {
            const nav = document.getElementById('main-nav');
            if (window.scrollY > 50) {
                nav.classList.add('py-2');
                nav.classList.remove('py-4');
            } else {
                nav.classList.remove('py-2');
                nav.classList.add('py-4');
            }
        });

        // Dropdown del menú
        const menuDropdownToggle = document.getElementById('menu-dropdown-toggle');
        const menuDropdown = document.getElementById('menu-dropdown');

        menuDropdownToggle.addEventListener('click', function(e) {
            e.preventDefault();
            menuDropdown.classList.toggle('active');
        });

        document.addEventListener('click', function(e) {
            if (!menuDropdownToggle.contains(e.target) && !menuDropdown.contains(e.target)) {
                menuDropdown.classList.remove('active');
            }
        });
    </script>
</body>
</html>
